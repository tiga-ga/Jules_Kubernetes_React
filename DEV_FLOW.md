# 開発フローガイド (Development Workflow)

このドキュメントは、`gemini.md`（思考エンジン）と `AGENTS.md`（コンテキスト地図）を使用した、**ドキュメント駆動型バイブコーディング (DDVC)** の標準ワークフローを定義します。

---

## 1. ゼロからのスタート（Setup）

プロジェクト開始時に1回だけ行う作業です。

1.  **ファイルの配置:**
    * ルートディレクトリに `gemini.md`, `AGENTS.md`, `DEV_FLOW.md` を配置する。
2.  **AGENTS.md の記入:**
    * `AGENTS.md` の「Project Definition」と「Constraints」の空欄（[User記入欄]）を埋める。
3.  **キックオフ・プロンプト:**
    * AIチャット（Cursor/Windsurf等）で以下を送信する。
    > 「プロジェクトを開始します。`gemini.md` と `AGENTS.md` を読み込み、未定の技術スタック（Unselected部分）について提案を行ってください。」

---

## 2. 日常の開発サイクル (The DDVC Loop)

機能を実装する際は、必ず以下の **4ステップ** を守ります。「いきなりコードを書かせない」のが鉄則です。

### STEP 1: Vibe Input (要望を投げる)
あなたは自然言語で、実現したい機能の「ゴール」や「雰囲気」を伝えます。

* **Prompt例:**
    * 「ログイン画面を作りたい。Google認証で。」
    * 「ヘッダーのデザインがいまいちだから、もっとモダンにして。」
    * 「ユーザーがタスクを登録できるAPIを追加して。」

### STEP 2: Doc Update (仕様の更新)
AIは `gemini.md` の指示に従い、まず**ドキュメントの更新**を提案します。

* **AIの挙動:** `docs/PRD.md` や `docs/SCHEMA.md` の変更案を表示する。
* **あなたのAction:** その仕様で良いか確認し、「OK」「ここはこう変えて」と返答する。

### STEP 3: Implementation (実装)
ドキュメントの合意が取れて初めて、AIがコードを生成します。

* **AIの挙動:** `AGENTS.md` の技術スタックに従ってコーディングを行う。
* **注意点:** もしAIが勝手にライブラリを追加しようとしたら、「`AGENTS.md` に記載がないが、追加して良いか？」と確認させる（またはAIが自律的に確認してくる）。

### STEP 4: Verification (検証 & 記録)
実装が完了したら、動作確認と情報の同期を行います。

* **あなたのAction:** 実際に動かして確認する。
* **AIのAction (重要):** 新しい技術や環境変数が追加された場合、**`AGENTS.md` の下部（Architecture Registry）を更新する。**

---

## 3. シーン別対応ガイド

### ケースA: 技術選定をAIに任せたい時
`AGENTS.md` の設定が `Unselected` になっている項目について相談する場合。

* **Prompt:**
    > 「バックエンドの構成を決めたい。`AGENTS.md` の要件に基づいて、GoとPythonのどちらが良いか、理由付きで比較提案して。」
* **Go:**
    > 「決定。`AGENTS.md` を更新して。」

### ケースB: バグ修正 (Bug Fix)
単なるタイポ修正ならそのまま直してOKですが、ロジックが変わる修正の場合。

* **Prompt:**
    > 「計算ロジックにバグがある。修正してほしいが、仕様自体が間違っている可能性があるので、まず `docs/LOGIC.md` の記述を確認して。」

### ケースC: 久しぶりに開発を再開する時
コンテキストをAIに再ロードさせます。

* **Prompt:**
    > 「開発を再開する。`AGENTS.md` と `docs/` 以下のファイルを読んで、現在のプロジェクトの状態と、次にやるべきタスクを教えて。」

---

## 4. べからず集 (Anti-Patterns)

* ❌ **ドキュメント無視:** 「面倒だからとりあえず動くコード書いて」と指示する。（→ スパゲッティコードの温床）
* ❌ **AGENTS.md の手動更新忘れ:** AIに新しいライブラリを入れさせたのに、`AGENTS.md` に反映させない。（→ 次のセッションでAIが混乱する）
* ❌ **英語での指示:** `gemini.md` で日本語思考を指定しているため、英語で指示するとペルソナがブレる可能性がある。

---

## 5. 完了の定義 (Definition of Done)

タスク完了とは、以下の状態を指す。
1.  コードが動作し、テストが通る。
2.  関連するドキュメント（`docs/`）が更新されている。
3.  構成変更があれば `AGENTS.md` が更新されている。